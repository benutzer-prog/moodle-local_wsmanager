define("local_wsmanager/dashboard_mdl39",["exports","core/ajax","core/modal_factory","core/modal_events","jquery"],(function(_exports,_ajax,_modal_factory,_modal_events,_jquery){function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}
/**
   * Dashboard actions for Moodle >=3.9
   *
   * @module     local_wsmanager/dashboard_mdl39
   * @copyright  2024 Lilia Smirnova <lilia.pro@protonmail.com>
   * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
   */Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.init=void 0,_modal_factory=_interopRequireDefault(_modal_factory),_modal_events=_interopRequireDefault(_modal_events),_jquery=_interopRequireDefault(_jquery);const local_wsmanager_protocols=()=>(0,_jquery.default)(".local_wsmanager_protocol_check_row input[type=checkbox]").map((function(){return(0,_jquery.default)(this).data("protocol")})).get(),local_wsmanager_webservice_dashboard_mobile_info_output=()=>{(0,_ajax.call)([{methodname:"local_wsmanager_webservice_dashboard_mobile_info_output",args:{}}])[0].then((function(output){(0,_jquery.default)("#local_wsmanager_webservice_dashboard_mobile_info_output").html(output)}))},local_wsmanager_webservice_dashboard_protocol_status_output=()=>{var protocols=local_wsmanager_protocols();protocols.length>0&&_jquery.default.each(protocols,(function(i,protocol){(0,_ajax.call)([{methodname:"local_wsmanager_webservice_protocol_status_output",args:{protocol:protocol}}])[0].then((function(output){(0,_jquery.default)("#local_wsmanager_protocol_status_"+protocol).html(output)}))}))},local_wsmanager_webservice_test_dashboard_table_output=(sep1,sep2,sep3,sep4)=>{(0,_ajax.call)([{methodname:"local_wsmanager_webservice_test_dashboard_table_output",args:{}}])[0].then((function(output){(0,_jquery.default)("#local_wsmanager_webservice_test_dashboard_table_output").html(output)}))},local_wsmanager_webservice_dashboard_info_output=()=>{(0,_ajax.call)([{methodname:"local_wsmanager_webservice_dashboard_info_output",args:{}}])[0].then((function(output){(0,_jquery.default)("#local_wsmanager_dashboard_info").html(output)}))},local_wsmanager_webservice_enable_handle=()=>{(0,_jquery.default)(".local_wsmanager_enablewebservices_check").hide(),(0,_jquery.default)("#local_wsmanager_enablewebservices_check_ok").show(),(0,_jquery.default)(".local_wsmanager_protocol_check_row input[type=checkbox]").prop("disabled",!1),(0,_jquery.default)("#local_wsmanager_webservice_mobile_switch").prop("disabled",!1),local_wsmanager_webservice_dashboard_info_output(),local_wsmanager_webservice_dashboard_protocol_status_output()};_exports.init=(sep1,sep2,sep3,sep4)=>{(0,_jquery.default)("#local_wsmanager_switch_webservice_state").on("change",(function(){var $this=(0,_jquery.default)(this);return $this.is(":checked")?(0,_ajax.call)([{methodname:"local_wsmanager_webservices_state_switch",args:{}}])[0].then((function(res){res.enabled||(local_wsmanager_webservice_enable_handle(),local_wsmanager_webservice_test_dashboard_table_output(),$this.prop("checked",!0),res.active&&(0,_jquery.default)(".local_wsmanager_state_wrapper").show())})):_modal_factory.default.create({type:_modal_factory.default.types.SAVE_CANCEL,title:M.str.local_wsmanager.webservices_disable,body:M.str.moodle.areyousure}).then((modal=>{let root=modal.getRoot();modal.setButtonText("save",M.str.moodle.disable),root.on(_modal_events.default.save,(function(e){e.preventDefault(),(0,_ajax.call)([{methodname:"local_wsmanager_webservices_state_switch",args:{}}])[0].then((function(res){res.enabled&&((0,_jquery.default)(".local_wsmanager_enablewebservices_check").hide(),(0,_jquery.default)("#local_wsmanager_enablewebservices_check_error").show(),(0,_jquery.default)(".local_wsmanager_protocol_check_row input[type=checkbox]").prop("checked",!1).prop("disabled",!0),(0,_jquery.default)("#local_wsmanager_webservice_mobile_switch").prop("checked",!1).prop("disabled",!0),(0,_jquery.default)(".local_wsmanager_state_wrapper").hide(),local_wsmanager_webservice_dashboard_info_output(),local_wsmanager_webservice_dashboard_protocol_status_output(),local_wsmanager_webservice_test_dashboard_table_output(),$this.prop("checked",!1))})),modal.hide()})),root.on(_modal_events.default.cancel,(function(){$this.prop("checked",!0),modal.hide()})),modal.show()})),!1})),(0,_jquery.default)(".local_wsmanager_protocols_switch input[type=checkbox]").on("change",(function(){var $this=(0,_jquery.default)(this),protocol=$this.data("protocol");return $this.is(":checked")?(0,_ajax.call)([{methodname:"local_wsmanager_webservices_protocol_switch",args:{protocol:protocol}}])[0].then((function(res){res.enabled||(local_wsmanager_webservice_dashboard_info_output(),local_wsmanager_webservice_dashboard_protocol_status_output(),local_wsmanager_webservice_test_dashboard_table_output(),$this.prop("checked",!0)),res.active?(0,_jquery.default)(".local_wsmanager_state_wrapper").show():(0,_jquery.default)(".local_wsmanager_state_wrapper").hide()})):_modal_factory.default.create({type:_modal_factory.default.types.SAVE_CANCEL,title:M.str.local_wsmanager.webservices_protocol_disable,body:M.str.moodle.areyousure}).then((modal=>{let root=modal.getRoot();modal.setButtonText("save",M.str.moodle.disable),root.on(_modal_events.default.save,(function(e){e.preventDefault(),(0,_ajax.call)([{methodname:"local_wsmanager_webservices_protocol_switch",args:{protocol:protocol}}])[0].then((function(res){res.enabled&&(local_wsmanager_webservice_dashboard_info_output(),local_wsmanager_webservice_dashboard_protocol_status_output(),local_wsmanager_webservice_test_dashboard_table_output(),$this.prop("checked",!1)),res.active?(0,_jquery.default)(".local_wsmanager_state_wrapper").show():(0,_jquery.default)(".local_wsmanager_state_wrapper").hide()})),modal.hide()})),root.on(_modal_events.default.cancel,(function(){$this.prop("checked",!0),modal.hide()})),modal.show()})),!1})),(0,_jquery.default)("#local_wsmanager_switch_wsdocumentation").on("change",(function(){(0,_jquery.default)(this);return(0,_ajax.call)([{methodname:"local_wsmanager_webservice_documentation_switch",args:{}}])[0].then((function(switched){})),!1})),(0,_jquery.default)("body").on("change","#local_wsmanager_webservice_mobile_switch",(function(event){var $this=(0,_jquery.default)(this);return $this.is(":checked")?(0,_ajax.call)([{methodname:"local_wsmanager_webservice_mobile_state_switch",args:{}}])[0].then((function(res){res.enabled||((0,_jquery.default)(".local_wsmanager_mobileapp_check").hide(),(0,_jquery.default)("#local_wsmanager_mobileapp_check_ok").show(),local_wsmanager_webservice_dashboard_mobile_info_output(),$this.prop("checked",!0))})):_modal_factory.default.create({type:_modal_factory.default.types.SAVE_CANCEL,title:M.str.local_wsmanager.webservices_protocol_disable,body:M.str.moodle.areyousure}).then((modal=>{let root=modal.getRoot();modal.setButtonText("save",M.str.moodle.disable),root.on(_modal_events.default.save,(function(e){e.preventDefault(),(0,_ajax.call)([{methodname:"local_wsmanager_webservice_mobile_state_switch",args:{}}])[0].then((function(res){res.enabled&&((0,_jquery.default)(".local_wsmanager_mobileapp_check").hide(),(0,_jquery.default)("#local_wsmanager_mobileapp_check_error").show(),local_wsmanager_webservice_dashboard_mobile_info_output(),$this.prop("checked",!1))})),modal.hide()})),root.on(_modal_events.default.cancel,(function(){$this.prop("checked",!0),modal.hide()})),modal.show()})),!1})).on("click","#local_wsmanager_webservices_fix",(function(event){event.preventDefault();(0,_jquery.default)(this);return(0,_ajax.call)([{methodname:"local_wsmanager_webservices_enable_fix",args:{}}])[0].then((function(res){res.enablewebservices&&(local_wsmanager_webservice_enable_handle(),(0,_jquery.default)("#local_wsmanager_switch_webservice_state").prop("checked",!0)),res.webserviceprotocols&&(local_wsmanager_webservice_enable_handle(),local_wsmanager_webservice_dashboard_protocol_status_output(),(0,_jquery.default)("#local_wsmanager_protocol_switch_rest").prop("checked",!0))})),!1})).on("click","#local_wsmanager_webservice_test_create_button",(function(event){event.preventDefault();(0,_jquery.default)(this);return _modal_factory.default.create({type:_modal_factory.default.types.SAVE_CANCEL,title:M.str.local_wsmanager.webservice_test_create,body:M.str.moodle.areyousure}).then((modal=>{let root=modal.getRoot();modal.setButtonText("save",M.str.local_wsmanager.webservice_test_create),root.on(_modal_events.default.save,(function(e){e.preventDefault(),(0,_ajax.call)([{methodname:"local_wsmanager_webservice_test_create",args:{}}])[0].then((function(res){res&&local_wsmanager_webservice_test_dashboard_table_output()})),modal.hide()})),root.on(_modal_events.default.cancel,(function(){modal.hide()})),modal.show()})),!1})).on("click","#local_wsmanager_webservice_test_delete",(function(event){event.preventDefault();var $this=(0,_jquery.default)(this),webserviceid=parseInt($this.data("webserviceid"));return webserviceid&&_modal_factory.default.create({type:_modal_factory.default.types.SAVE_CANCEL,title:M.str.local_wsmanager.webservice_test_delete,body:M.str.moodle.areyousure}).then((modal=>{let root=modal.getRoot();modal.setButtonText("save",M.str.moodle.delete),root.on(_modal_events.default.save,(function(e){e.preventDefault(),(0,_ajax.call)([{methodname:"local_wsmanager_webservice_delete",args:{webserviceid:webserviceid}}])[0].then((function(res){local_wsmanager_webservice_test_dashboard_table_output()})),modal.hide()})),root.on(_modal_events.default.cancel,(function(){modal.hide()})),modal.show()})),!1}))}}));

//# sourceMappingURL=dashboard_mdl39.min.js.map