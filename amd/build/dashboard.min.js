/**
 * Dashboard actions.
 *
 * @module     local_wsmanager/dashboard
 * @copyright  2023 Lilia Smirnova <lilia.pro@protonmail.com>
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("local_wsmanager/dashboard",["jquery","core/ajax","core/modal_factory","core/modal_events","local_wsmanager/base"],(function(jQuery,ajax,ModalFactory,ModalEvents,LocalWSManagerBase){return{local_wsmanager_protocols:function(){return jQuery(".local_wsmanager_protocol_check_row input[type=checkbox]").map((function(){return jQuery(this).data("protocol")})).get()},local_wsmanager_webservice_dashboard_mobile_info_output:function(){return ajax.call([{methodname:"local_wsmanager_webservice_dashboard_mobile_info_output",args:{}}])[0].then((function(output){jQuery("#local_wsmanager_webservice_dashboard_mobile_info_output").html(output)}))},local_wsmanager_webservice_dashboard_protocol_status_output:function(){var protocols=this.local_wsmanager_protocols();protocols.length>0&&jQuery.each(protocols,(function(i,protocol){ajax.call([{methodname:"local_wsmanager_webservice_protocol_status_output",args:{protocol:protocol}}])[0].then((function(output){jQuery("#local_wsmanager_protocol_status_"+protocol).html(output)}))}))},local_wsmanager_webservice_test_dashboard_table_output:function(sep1,sep2,sep3,sep4){return ajax.call([{methodname:"local_wsmanager_webservice_test_dashboard_table_output",args:{}}])[0].then((function(output){jQuery("#local_wsmanager_webservice_test_dashboard_table_output").html(output)}))},local_wsmanager_webservice_dashboard_info_output:function(){return ajax.call([{methodname:"local_wsmanager_webservice_dashboard_info_output",args:{}}])[0].then((function(output){jQuery("#local_wsmanager_dashboard_info").html(output)}))},local_wsmanager_webservice_enable_handle:function(){jQuery(".local_wsmanager_enablewebservices_check").hide(),jQuery("#local_wsmanager_enablewebservices_check_ok").show(),jQuery(".local_wsmanager_protocol_check_row input[type=checkbox]").prop("disabled",!1),jQuery("#local_wsmanager_webservice_mobile_switch").prop("disabled",!1),this.local_wsmanager_webservice_dashboard_info_output(),this.local_wsmanager_webservice_dashboard_protocol_status_output()},init:function(sep1,sep2,sep3,sep4){var ctx=this;jQuery("#local_wsmanager_switch_webservice_state").on("change",(function(){var $this=jQuery(this);return $this.is(":checked")?ajax.call([{methodname:"local_wsmanager_webservices_state_switch",args:{}}])[0].then((function(res){res.enabled||(ctx.local_wsmanager_webservice_enable_handle(),ctx.local_wsmanager_webservice_test_dashboard_table_output(sep1,sep2,sep3,sep4),$this.prop("checked",!0),res.active&&jQuery(".local_wsmanager_state_wrapper").show())})):ModalFactory.create({type:ModalFactory.types.SAVE_CANCEL,title:M.str.local_wsmanager.webservices_disable,body:M.str.moodle.areyousure}).then((function(modal){modal.setButtonText("save",M.str.moodle.disable),modal.getRoot().on(ModalEvents.save,(function(e){e.preventDefault(),ajax.call([{methodname:"local_wsmanager_webservices_state_switch",args:{}}])[0].then((function(res){res.enabled&&(jQuery(".local_wsmanager_enablewebservices_check").hide(),jQuery("#local_wsmanager_enablewebservices_check_error").show(),jQuery(".local_wsmanager_protocol_check_row input[type=checkbox]").prop("checked",!1).prop("disabled",!0),jQuery("#local_wsmanager_webservice_mobile_switch").prop("checked",!1).prop("disabled",!0),jQuery(".local_wsmanager_state_wrapper").hide(),ctx.local_wsmanager_webservice_dashboard_info_output(),ctx.local_wsmanager_webservice_dashboard_protocol_status_output(),ctx.local_wsmanager_webservice_test_dashboard_table_output(sep1,sep2,sep3,sep4),$this.prop("checked",!1))})),modal.hide()})),modal.getRoot().on(ModalEvents.cancel,(function(){$this.prop("checked",!0),modal.hide()})),modal.show()})),!1})),jQuery(".local_wsmanager_protocols_switch input[type=checkbox]").on("change",(function(){var $this=jQuery(this),protocol=$this.data("protocol");return $this.is(":checked")?ajax.call([{methodname:"local_wsmanager_webservices_protocol_switch",args:{protocol:protocol}}])[0].then((function(res){res.enabled||(ctx.local_wsmanager_webservice_dashboard_info_output(),ctx.local_wsmanager_webservice_dashboard_protocol_status_output(),ctx.local_wsmanager_webservice_test_dashboard_table_output(sep1,sep2,sep3,sep4),$this.prop("checked",!0)),res.active?jQuery(".local_wsmanager_state_wrapper").show():jQuery(".local_wsmanager_state_wrapper").hide()})):ModalFactory.create({type:ModalFactory.types.SAVE_CANCEL,title:M.str.local_wsmanager.webservices_protocol_disable,body:M.str.moodle.areyousure}).then((function(modal){modal.setButtonText("save",M.str.moodle.disable),modal.getRoot().on(ModalEvents.save,(function(e){e.preventDefault(),ajax.call([{methodname:"local_wsmanager_webservices_protocol_switch",args:{protocol:protocol}}])[0].then((function(res){res.enabled&&(ctx.local_wsmanager_webservice_dashboard_info_output(),ctx.local_wsmanager_webservice_dashboard_protocol_status_output(),ctx.local_wsmanager_webservice_test_dashboard_table_output(sep1,sep2,sep3,sep4),$this.prop("checked",!1)),res.active?jQuery(".local_wsmanager_state_wrapper").show():jQuery(".local_wsmanager_state_wrapper").hide()})),modal.hide()})),modal.getRoot().on(ModalEvents.cancel,(function(){$this.prop("checked",!0),modal.hide()})),modal.show()})),!1})),jQuery("#local_wsmanager_switch_wsdocumentation").on("change",(function(){jQuery(this);return ajax.call([{methodname:"local_wsmanager_webservice_documentation_switch",args:{}}])[0].then((function(switched){})),!1})),jQuery("body").on("change","#local_wsmanager_webservice_mobile_switch",(function(event){var $this=jQuery(this);return $this.is(":checked")?ajax.call([{methodname:"local_wsmanager_webservice_mobile_state_switch",args:{}}])[0].then((function(res){res.enabled||(jQuery(".local_wsmanager_mobileapp_check").hide(),jQuery("#local_wsmanager_mobileapp_check_ok").show(),ctx.local_wsmanager_webservice_dashboard_mobile_info_output(),$this.prop("checked",!0))})):ModalFactory.create({type:ModalFactory.types.SAVE_CANCEL,title:M.str.local_wsmanager.webservices_protocol_disable,body:M.str.moodle.areyousure}).then((function(modal){modal.setButtonText("save",M.str.moodle.disable),modal.getRoot().on(ModalEvents.save,(function(e){e.preventDefault(),ajax.call([{methodname:"local_wsmanager_webservice_mobile_state_switch",args:{}}])[0].then((function(res){res.enabled&&(jQuery(".local_wsmanager_mobileapp_check").hide(),jQuery("#local_wsmanager_mobileapp_check_error").show(),ctx.local_wsmanager_webservice_dashboard_mobile_info_output(),$this.prop("checked",!1))})),modal.hide()})),modal.getRoot().on(ModalEvents.cancel,(function(){$this.prop("checked",!0),modal.hide()})),modal.show()})),!1})).on("click","#local_wsmanager_webservices_fix",(function(event){event.preventDefault();jQuery(this);return ajax.call([{methodname:"local_wsmanager_webservices_enable_fix",args:{}}])[0].then((function(res){res.enablewebservices&&(ctx.local_wsmanager_webservice_enable_handle(),jQuery("#local_wsmanager_switch_webservice_state").prop("checked",!0)),res.webserviceprotocols&&(ctx.local_wsmanager_webservice_enable_handle(),ctx.local_wsmanager_webservice_dashboard_protocol_status_output(),jQuery("#local_wsmanager_protocol_switch_rest").prop("checked",!0))})),!1})).on("click","#local_wsmanager_webservice_test_create_button",(function(event){event.preventDefault();jQuery(this);return ModalFactory.create({type:ModalFactory.types.SAVE_CANCEL,title:M.str.local_wsmanager.webservice_test_create,body:M.str.moodle.areyousure}).then((function(modal){modal.setButtonText("save",M.str.local_wsmanager.webservice_test_create),modal.getRoot().on(ModalEvents.save,(function(e){e.preventDefault(),ajax.call([{methodname:"local_wsmanager_webservice_test_create",args:{}}])[0].then((function(res){res&&ctx.local_wsmanager_webservice_test_dashboard_table_output(sep1,sep2,sep3,sep4)})),modal.hide()})),modal.getRoot().on(ModalEvents.cancel,(function(){modal.hide()})),modal.show()})),!1})).on("click","#local_wsmanager_webservice_test_delete",(function(event){event.preventDefault();var $this=jQuery(this),webserviceid=parseInt($this.data("webserviceid"));return webserviceid&&ModalFactory.create({type:ModalFactory.types.SAVE_CANCEL,title:M.str.local_wsmanager.webservice_test_delete,body:M.str.moodle.areyousure}).then((function(modal){modal.setButtonText("save",M.str.moodle.delete),modal.getRoot().on(ModalEvents.save,(function(e){e.preventDefault(),ajax.call([{methodname:"local_wsmanager_webservice_delete",args:{webserviceid:webserviceid}}])[0].then((function(res){ctx.local_wsmanager_webservice_test_dashboard_table_output(sep1,sep2,sep3,sep4)})),modal.hide()})),modal.getRoot().on(ModalEvents.cancel,(function(){modal.hide()})),modal.show()})),!1}))}}}));

//# sourceMappingURL=dashboard.min.js.map