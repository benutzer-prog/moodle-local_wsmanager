/**
 * Dashboard actions.
 *
 * @module     local_wsmanager/dashboard
 * @copyright  2023 Lilia Smirnova <lilia.pro@protonmail.com>
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define(["jquery","core/ajax","core/modal_factory","core/modal_events","local_wsmanager/base"],(function(e,a,o,t,_){return{local_wsmanager_protocols:function(){return e(".local_wsmanager_protocol_check_row input[type=checkbox]").map((function(){return e(this).data("protocol")})).get()},local_wsmanager_webservice_dashboard_mobile_info_output:function(){return a.call([{methodname:"local_wsmanager_webservice_dashboard_mobile_info_output",args:{}}])[0].then((function(a){e("#local_wsmanager_webservice_dashboard_mobile_info_output").html(a)}))},local_wsmanager_webservice_dashboard_protocol_status_output:function(){var o=this.local_wsmanager_protocols();o.length>0&&e.each(o,(function(o,t){a.call([{methodname:"local_wsmanager_webservice_protocol_status_output",args:{protocol:t}}])[0].then((function(a){e("#local_wsmanager_protocol_status_"+t).html(a)}))}))},local_wsmanager_webservice_test_dashboard_table_output:function(o,t,_,c){return a.call([{methodname:"local_wsmanager_webservice_test_dashboard_table_output",args:{}}])[0].then((function(a){e("#local_wsmanager_webservice_test_dashboard_table_output").html(a)}))},local_wsmanager_webservice_dashboard_info_output:function(){return a.call([{methodname:"local_wsmanager_webservice_dashboard_info_output",args:{}}])[0].then((function(a){e("#local_wsmanager_dashboard_info").html(a)}))},local_wsmanager_webservice_enable_handle:function(){e(".local_wsmanager_enablewebservices_check").hide(),e("#local_wsmanager_enablewebservices_check_ok").show(),e(".local_wsmanager_protocol_check_row input[type=checkbox]").prop("disabled",!1),e("#local_wsmanager_webservice_mobile_switch").prop("disabled",!1),this.local_wsmanager_webservice_dashboard_info_output(),this.local_wsmanager_webservice_dashboard_protocol_status_output()},init:function(_,c,s,r){var l=this;e("#local_wsmanager_switch_webservice_state").on("change",(function(){var n=e(this);return n.is(":checked")?a.call([{methodname:"local_wsmanager_webservices_state_switch",args:{}}])[0].then((function(a){a.enabled||(l.local_wsmanager_webservice_enable_handle(),l.local_wsmanager_webservice_test_dashboard_table_output(_,c,s,r),n.prop("checked",!0),a.active&&e(".local_wsmanager_state_wrapper").show())})):o.create({type:o.types.SAVE_CANCEL,title:M.str.local_wsmanager.webservices_disable,body:M.str.moodle.areyousure}).then((function(o){o.setButtonText("save",M.str.moodle.disable),o.getRoot().on(t.save,(function(t){t.preventDefault(),a.call([{methodname:"local_wsmanager_webservices_state_switch",args:{}}])[0].then((function(a){a.enabled&&(e(".local_wsmanager_enablewebservices_check").hide(),e("#local_wsmanager_enablewebservices_check_error").show(),e(".local_wsmanager_protocol_check_row input[type=checkbox]").prop("checked",!1).prop("disabled",!0),e("#local_wsmanager_webservice_mobile_switch").prop("checked",!1).prop("disabled",!0),e(".local_wsmanager_state_wrapper").hide(),l.local_wsmanager_webservice_dashboard_info_output(),l.local_wsmanager_webservice_dashboard_protocol_status_output(),l.local_wsmanager_webservice_test_dashboard_table_output(_,c,s,r),n.prop("checked",!1))})),o.hide()})),o.getRoot().on(t.cancel,(function(){n.prop("checked",!0),o.hide()})),o.show()})),!1})),e(".local_wsmanager_protocols_switch input[type=checkbox]").on("change",(function(){var n=e(this),i=n.data("protocol");return n.is(":checked")?a.call([{methodname:"local_wsmanager_webservices_protocol_switch",args:{protocol:i}}])[0].then((function(a){a.enabled||(l.local_wsmanager_webservice_dashboard_info_output(),l.local_wsmanager_webservice_dashboard_protocol_status_output(),l.local_wsmanager_webservice_test_dashboard_table_output(_,c,s,r),n.prop("checked",!0)),a.active?e(".local_wsmanager_state_wrapper").show():e(".local_wsmanager_state_wrapper").hide()})):o.create({type:o.types.SAVE_CANCEL,title:M.str.local_wsmanager.webservices_protocol_disable,body:M.str.moodle.areyousure}).then((function(o){o.setButtonText("save",M.str.moodle.disable),o.getRoot().on(t.save,(function(t){t.preventDefault(),a.call([{methodname:"local_wsmanager_webservices_protocol_switch",args:{protocol:i}}])[0].then((function(a){a.enabled&&(l.local_wsmanager_webservice_dashboard_info_output(),l.local_wsmanager_webservice_dashboard_protocol_status_output(),l.local_wsmanager_webservice_test_dashboard_table_output(_,c,s,r),n.prop("checked",!1)),a.active?e(".local_wsmanager_state_wrapper").show():e(".local_wsmanager_state_wrapper").hide()})),o.hide()})),o.getRoot().on(t.cancel,(function(){n.prop("checked",!0),o.hide()})),o.show()})),!1})),e("#local_wsmanager_switch_wsdocumentation").on("change",(function(){e(this);return a.call([{methodname:"local_wsmanager_webservice_documentation_switch",args:{}}])[0].then((function(e){})),!1})),e("body").on("change","#local_wsmanager_webservice_mobile_switch",(function(_){var c=e(this);return c.is(":checked")?a.call([{methodname:"local_wsmanager_webservice_mobile_state_switch",args:{}}])[0].then((function(a){a.enabled||(e(".local_wsmanager_mobileapp_check").hide(),e("#local_wsmanager_mobileapp_check_ok").show(),l.local_wsmanager_webservice_dashboard_mobile_info_output(),c.prop("checked",!0))})):o.create({type:o.types.SAVE_CANCEL,title:M.str.local_wsmanager.webservices_protocol_disable,body:M.str.moodle.areyousure}).then((function(o){o.setButtonText("save",M.str.moodle.disable),o.getRoot().on(t.save,(function(t){t.preventDefault(),a.call([{methodname:"local_wsmanager_webservice_mobile_state_switch",args:{}}])[0].then((function(a){a.enabled&&(e(".local_wsmanager_mobileapp_check").hide(),e("#local_wsmanager_mobileapp_check_error").show(),l.local_wsmanager_webservice_dashboard_mobile_info_output(),c.prop("checked",!1))})),o.hide()})),o.getRoot().on(t.cancel,(function(){c.prop("checked",!0),o.hide()})),o.show()})),!1})).on("click","#local_wsmanager_webservices_fix",(function(o){o.preventDefault();e(this);return a.call([{methodname:"local_wsmanager_webservices_enable_fix",args:{}}])[0].then((function(a){a.enablewebservices&&(l.local_wsmanager_webservice_enable_handle(),e("#local_wsmanager_switch_webservice_state").prop("checked",!0)),a.webserviceprotocols&&(l.local_wsmanager_webservice_enable_handle(),l.local_wsmanager_webservice_dashboard_protocol_status_output(),e("#local_wsmanager_protocol_switch_rest").prop("checked",!0))})),!1})).on("click","#local_wsmanager_webservice_test_create_button",(function(n){n.preventDefault();e(this);return o.create({type:o.types.SAVE_CANCEL,title:M.str.local_wsmanager.webservice_test_create,body:M.str.moodle.areyousure}).then((function(e){e.setButtonText("save",M.str.local_wsmanager.webservice_test_create),e.getRoot().on(t.save,(function(o){o.preventDefault(),a.call([{methodname:"local_wsmanager_webservice_test_create",args:{}}])[0].then((function(e){e&&l.local_wsmanager_webservice_test_dashboard_table_output(_,c,s,r)})),e.hide()})),e.getRoot().on(t.cancel,(function(){e.hide()})),e.show()})),!1})).on("click","#local_wsmanager_webservice_test_delete",(function(n){n.preventDefault();var i=e(this),w=parseInt(i.data("webserviceid"));return w&&o.create({type:o.types.SAVE_CANCEL,title:M.str.local_wsmanager.webservice_test_delete,body:M.str.moodle.areyousure}).then((function(e){e.setButtonText("save",M.str.moodle.delete),e.getRoot().on(t.save,(function(o){o.preventDefault(),a.call([{methodname:"local_wsmanager_webservice_delete",args:{webserviceid:w}}])[0].then((function(e){l.local_wsmanager_webservice_test_dashboard_table_output(_,c,s,r)})),e.hide()})),e.getRoot().on(t.cancel,(function(){e.hide()})),e.show()})),!1}))}}}));