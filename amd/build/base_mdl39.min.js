define("local_wsmanager/base_mdl39",["exports","core/ajax","core/modal_factory","core/modal_events","jquery"],(function(_exports,_ajax,_modal_factory,_modal_events,_jquery){function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}
/**
   * Base actions for Moodle >=3.9
   *
   * @module     local_wsmanager/base_mdl39
   * @copyright  2024 Lilia Smirnova <lilia.pro@protonmail.com>
   * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
   */Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.init=void 0,_modal_factory=_interopRequireDefault(_modal_factory),_modal_events=_interopRequireDefault(_modal_events),_jquery=_interopRequireDefault(_jquery);const local_wsmanager_webservice_nav_title=webserviceid=>(0,_ajax.call)([{methodname:"local_wsmanager_webservice_nav_title",args:{webserviceid:webserviceid}}])[0].then((function(response){(0,_jquery.default)("#local_wsmanager_tab_link_webservice_"+webserviceid).html(response)})),local_wsmanager_users_table_output=webserviceid=>(0,_ajax.call)([{methodname:"local_wsmanager_webservice_users_table_output",args:{webserviceid:webserviceid}}])[0].then((function(res){(0,_jquery.default)("#local_wsmanager_webservice_users_table_"+webserviceid).html(res)})),local_wsmanager_webservice_functions_get_params=(webserviceid,functionname,sep1,sep2,sep3,sep4)=>{var ret="";return(0,_jquery.default)('[id*="local_wsmanager_ws_fn_param_'+webserviceid+"_"+functionname+'"]').each((function(){var $this=(0,_jquery.default)(this),arr=$this.attr("id").replace("local_wsmanager_ws_fn_param_"+webserviceid+"_"+functionname,"").split("_");ret+=webserviceid+sep1+functionname+sep1+arr[1]+sep1+$this.val()+sep4})),ret},local_wsmanager_request_info=(webserviceid,functionname,params,method,protocol,restformat,token)=>(method||(method=(0,_jquery.default)("#local_wsmanager_external_function_handle_method_"+webserviceid+"_"+functionname+" select").val()),protocol||(protocol=(0,_jquery.default)("#local_wsmanager_external_function_handle_protocol_"+webserviceid+"_"+functionname+" select").val()),restformat||(restformat=(0,_jquery.default)("#local_wsmanager_external_function_handle_restformat_"+webserviceid+"_"+functionname+" select").val()),token||(token=(0,_jquery.default)("#local_wsmanager_external_function_handle_token_"+webserviceid+"_"+functionname+" select option:selected").text()),(0,_ajax.call)([{methodname:"local_wsmanager_request_info",args:{webserviceid:webserviceid,functionname:functionname,params:params,method:method,protocol:protocol,restformat:restformat,token:token}}])[0].then((function(res){(0,_jquery.default)("#local_wsmanager_request_info_"+webserviceid+"_"+functionname).html(res)}))),local_wsmanager_external_function_handle_output=(functionname,webserviceid)=>(0,_ajax.call)([{methodname:"local_wsmanager_external_function_handle_output",args:{functionname:functionname,webserviceid:webserviceid}}])[0].then((function(res){return res}));_exports.init=async(sep1,sep2,sep3,sep4)=>{(0,_jquery.default)("body").on("change",'[data-switch="webservice"]',(function(event){var $this=(0,_jquery.default)(this),webserviceid=parseInt($this.data("webserviceid")),instance=$this.data("instance"),name=$this.data("name");return $this.is(":checked")?(0,_ajax.call)([{methodname:"local_wsmanager_webservice_state_switch",args:{webserviceid:webserviceid,instance:instance}}])[0].then((function(response){switch(instance){case"restrictedusers":local_wsmanager_users_table_output(webserviceid);break;case"enabled":local_wsmanager_webservice_nav_title(webserviceid),(0,_jquery.default)("#local_wsmanager_webservice_row_"+webserviceid).removeClass("local_wsmanager_webservice_row_danger"),(0,_jquery.default)("#local_wsmanager_webservice_name_"+webserviceid).attr("disabled",!1)}})):_modal_factory.default.create({type:_modal_factory.default.types.SAVE_CANCEL,title:M.str.moodle.disable,body:M.str.moodle.disable+"<strong>"+name+"</strong><br>"+M.str.moodle.areyousure}).then((modal=>{let root=modal.getRoot();modal.setButtonText("save",M.str.moodle.disable),root.on(_modal_events.default.save,(function(e){e.preventDefault(),(0,_ajax.call)([{methodname:"local_wsmanager_webservice_state_switch",args:{webserviceid:webserviceid,instance:instance}}])[0].then((function(response){switch(instance){case"restrictedusers":local_wsmanager_users_table_output(webserviceid);break;case"enabled":local_wsmanager_webservice_nav_title(webserviceid),(0,_jquery.default)("#local_wsmanager_webservice_row_"+webserviceid).addClass("local_wsmanager_webservice_row_danger"),(0,_jquery.default)("#local_wsmanager_webservice_name_"+webserviceid).attr("disabled",!0)}})),modal.hide()})),root.on(_modal_events.default.cancel,(function(){$this.prop("checked",!0),modal.hide()})),modal.show()})),!1})).on("click",".local_wsmanager_external_function_handle_wrapper",(function(event){var $this=(0,_jquery.default)(this),webserviceid=parseInt($this.data("webserviceid")),functionname=$this.data("functionname");return event.preventDefault(),_modal_factory.default.create({type:_modal_factory.default.types.DEFAULT,large:!0,title:M.str.local_wsmanager.test,body:local_wsmanager_external_function_handle_output(functionname,webserviceid)}).then((function(modal){modal.show()})),!1})).on("change",".local_wsmanager_external_function_handle_select select",(function(event){event.preventDefault();var $this=(0,_jquery.default)(this),parent=$this.closest(".local_wsmanager_external_function_handle_select"),webserviceid=parseInt(parent.data("webserviceid")),functionname=parent.data("functionname"),params=local_wsmanager_webservice_functions_get_params(webserviceid,functionname,sep1,0,0,sep4),method=(0,_jquery.default)("#local_wsmanager_external_function_handle_method_"+webserviceid+"_"+functionname+" select").val(),protocol=(0,_jquery.default)("#local_wsmanager_external_function_handle_protocol_"+webserviceid+"_"+functionname+" select").val(),restformat=(0,_jquery.default)("#local_wsmanager_external_function_handle_restformat_"+webserviceid+"_"+functionname+" select").val(),token=(0,_jquery.default)("#local_wsmanager_external_function_handle_token_"+webserviceid+"_"+functionname+" select option:selected").text();if("protocol"===parent.data("instance"))"rest"!=$this.val()?(0,_jquery.default)("#local_wsmanager_external_function_handle_restformat_row_"+webserviceid+"_"+functionname).hide():(0,_jquery.default)("#local_wsmanager_external_function_handle_restformat_row_"+webserviceid+"_"+functionname).show();return local_wsmanager_request_info(webserviceid,functionname,params,method,protocol,restformat,token)})).on("blur",".local_wsmanager_webservice_function_param_value input,.local_wsmanager_webservice_function_param_value textarea",(function(event){event.preventDefault();var parent=(0,_jquery.default)(this).closest(".local_wsmanager_webservice_function_param_value"),webserviceid=parseInt(parent.data("webserviceid")),functionname=parent.data("functionname"),params=local_wsmanager_webservice_functions_get_params(webserviceid,functionname,sep1,0,0,sep4),method=(0,_jquery.default)("#local_wsmanager_external_function_handle_method_"+webserviceid+"_"+functionname+" select").val(),protocol=(0,_jquery.default)("#local_wsmanager_external_function_handle_protocol_"+webserviceid+"_"+functionname+" select").val(),restformat=(0,_jquery.default)("#local_wsmanager_external_function_handle_restformat_"+webserviceid+"_"+functionname+" select").val(),token=(0,_jquery.default)("#local_wsmanager_external_function_handle_token_"+webserviceid+"_"+functionname+" select option:selected").text();return local_wsmanager_request_info(webserviceid,functionname,params,method,protocol,restformat,token)})).on("click",".local_wsmanager_external_function_handle",(function(event){event.preventDefault();var $this=(0,_jquery.default)(this),webserviceid=parseInt($this.data("webserviceid")),functionname=$this.data("functionname"),token=(0,_jquery.default)("#local_wsmanager_external_function_handle_token_"+webserviceid+"_"+functionname+" select option:selected").text(),params=local_wsmanager_webservice_functions_get_params(webserviceid,functionname,sep1,0,0,sep4),method=(0,_jquery.default)("#local_wsmanager_external_function_handle_method_"+webserviceid+"_"+functionname+" select").val(),protocol=(0,_jquery.default)("#local_wsmanager_external_function_handle_protocol_"+webserviceid+"_"+functionname+" select").val(),restformat=(0,_jquery.default)("#local_wsmanager_external_function_handle_restformat_"+webserviceid+"_"+functionname+" select").val();return _modal_factory.default.create({type:_modal_factory.default.types.SAVE_CANCEL,title:M.str.webservice.execute,body:M.str.webservice.execute+" <strong>"+functionname+"</strong><br />"+M.str.moodle.areyousure}).then((function(modal){let root=modal.getRoot();modal.setButtonText("save",M.str.moodle.yes),root.on(_modal_events.default.save,(function(e){e.preventDefault(),(0,_ajax.call)([{methodname:"local_wsmanager_external_function_handle",args:{webserviceid:webserviceid,functionname:functionname,token:token,params:params,method:method,moodlewsprotocol:protocol,moodlewsrestformat:restformat}}])[0].then((function(res){(0,_jquery.default)("#local_wsmanager_external_function_handle_response_content_"+webserviceid+"_"+functionname).html(res),(0,_jquery.default)("#local_wsmanager_external_function_handle_response_"+webserviceid+"_"+functionname).show()})),modal.hide()})),root.on(_modal_events.default.cancel,(function(){modal.hide()})),modal.show()})),!1})).on("click",".local_wsmanager_webservice_name_update",(function(event){event.preventDefault();var $this=(0,_jquery.default)(this),webserviceid=parseInt($this.data("webserviceid")),name=(0,_jquery.default)("#local_wsmanager_webservice_name_"+webserviceid).val();return(0,_ajax.call)([{methodname:"local_wsmanager_webservice_rename",args:{webserviceid:webserviceid,name:name}}])[0].then((function(res){_modal_factory.default.create({type:_modal_factory.default.types.DEFAULT,title:M.str.moodle.summary,body:res?M.str.moodle.success:M.str.moodle.error}).then((function(modal){modal.getRoot().on(_modal_events.default.cancel,(function(){modal.hide()})),modal.show(),res&&(0,_jquery.default)("#local_wsmanager_tab_link_webservice_"+webserviceid).html(name)}))})),!1}))}}));

//# sourceMappingURL=base_mdl39.min.js.map